<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>4 Lunas</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="/css/demo.css" rel="stylesheet" />
    <link href='/fullcalendar/main.css' rel='stylesheet' />
    <script src='/fullcalendar/main.js'></script>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="/img/sidebar-5.jpg">
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a href="#" class="simple-text">
                    4 Lunas
                    </a>
                </div>
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/calendar-period">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>Home</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="/edit-cycle-date">
                            <i class="nc-icon nc-watch-time"></i>
                            <p>Start Period</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="/annotations">
                            <i class="nc-icon nc-single-copy-04"></i>
                            <p>Report</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg" color-on-scroll="500">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#"> Dashboard </a>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/logout-user">
                                    <span class="no-icon">Log out</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="position-carousel">
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <% if (banners.length !== 0) { %>
                            <div class="carousel-item active">
                                <img class="d-block w-100 img-fluid" src="/uploads/<%= banners[0].url_imagen_banner %>">
                            </div>
                            <% for (var count = 0; count < banners.length; count++) { %>
                                <% if (count !== 0) { %>
                                    <div class="carousel-item">
                                        <img class="d-block w-100 img-fluid" src="/uploads/<%= banners[count].url_imagen_banner %>">
                                    </div>
                                <% } %>
                            <% } %>
                        <% } else { %>
                            <div class="carousel-item">
                                <img class="d-block w-100 img-fluid" src="#">
                            </div>
                        <% } %>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div id='calendar'></div>
                            <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <form method="POST" action="/calendar-period">
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label>Note</label>
                                                            <textarea 
                                                                type="text" 
                                                                name="descripcion_anotacion" 
                                                                id="descripcion_anotacion" 
                                                                class="form-control"
                                                                rows="3"
                                                                style="height:100%;"
                                                                required
                                                            ></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>End of period</label>
                                                            <input 
                                                                type="date"
                                                                name="fin_periodo_anotacion" 
                                                                id="fin_periodo_anotacion" 
                                                                class="form-control"
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Date of sexual act</label>
                                                            <input 
                                                                type="datetime-local"
                                                                name="fecha_acto_sexual_anotacion" 
                                                                id="fecha_acto_sexual_anotacion" 
                                                                class="form-control"
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Actual weight</label>
                                                            <input 
                                                                type="text"
                                                                name="peso_actual_anotacion" 
                                                                id="peso_actual_anotacion" 
                                                                class="form-control"
                                                                required
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Mood</label>
                                                            <div class="selector">
                                                                <input id="sad" type="radio" name="estado_animo_anotacion" value="sad" />
                                                                <label class="mood sad" for="sad">&#128532;</label>
                                                                <input id="regular" type="radio" name="estado_animo_anotacion" value="regular" />
                                                                <label class="mood regular"for="regular">&#128528;</label>
                                                                <input id="happy" type="radio" name="estado_animo_anotacion" value="happy" />
                                                                <label class="mood happy"for="happy">&#128512;</label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <input 
                                                                type="hidden"
                                                                name="fecha_anotacion" 
                                                                id="fecha_anotacion" 
                                                                class="form-control"
                                                                required
                                                            >
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="modal fade" id="modalModifyEvent" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <form method="POST" action="/update-calendar-period">
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label>Note</label>
                                                            <textarea 
                                                                type="text" 
                                                                name="descripcion_anotacion" 
                                                                id="descripcion_anotacion" 
                                                                class="form-control"
                                                                rows="3"
                                                                style="height:100%;"
                                                                required
                                                            ></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>End of period</label>
                                                            <input 
                                                                type="date"
                                                                name="fin_periodo_anotacion" 
                                                                id="fin_periodo_anotacion" 
                                                                class="form-control"
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Date of sexual act</label>
                                                            <input 
                                                                type="datetime-local"
                                                                name="fecha_acto_sexual_anotacion" 
                                                                id="fecha_acto_sexual_anotacion" 
                                                                class="form-control"
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Actual weight</label>
                                                            <input 
                                                                type="text"
                                                                name="peso_actual_anotacion" 
                                                                id="peso_actual_anotacion" 
                                                                class="form-control"
                                                                required
                                                            >
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Mood</label>
                                                            <div class="selector">
                                                                <input id="sad-two" type="radio" name="estado_animo_anotacion" value="sad" />
                                                                <label class="mood sad-two" for="sad-two">&#128532;</label>
                                                                <input id="regular-two" type="radio" name="estado_animo_anotacion" value="regular" />
                                                                <label class="mood regular-two"for="regular-two">&#128528;</label>
                                                                <input id="happy-two" type="radio" name="estado_animo_anotacion" value="happy" />
                                                                <label class="mood happy-two"for="happy-two">&#128512;</label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <input 
                                                                type="hidden"
                                                                name="id_anotacion" 
                                                                id="id_anotacion" 
                                                                class="form-control"
                                                                required
                                                            >
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-warning">Modify</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <p class="copyright text-center">
                            ©
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                        </p>
                    </nav>
                </div>
            </footer>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="/js/core/popper.min.js" type="text/javascript"></script>
<script src="/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="/js/plugins/bootstrap-switch.js"></script>
<!--  Chartist Plugin  -->
<script src="/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="/js/demo.js"></script>
<script type="text/javascript">
    var day = <%- JSON.stringify(elapsedDay) %>;
    var testosterone = <%- JSON.stringify(testosteroneArray) %>;
    var estrogen = <%- JSON.stringify(estrogenArray) %>;
    var progesterone = <%- JSON.stringify(progesteroneArray) %>;
    var periodDays = <%- JSON.stringify(periodDays) %>;
    var averageHappyDate = <%- JSON.stringify(averageHappyDate) %>;
    var averageSadDate = <%- JSON.stringify(averageSadDate) %>;
    $(document).ready(function() {
        demo.showNotificationTestosterone('top', 'right', day, periodDays, testosterone);
        demo.showNotificationEstrogen('top', 'right', day, periodDays, estrogen);
        demo.showNotificationProgesterone('top', 'right', day, periodDays, progesterone);
        demo.showNotificationHappy('bottom','left', averageHappyDate);
        demo.showNotificationSad('bottom','left', averageSadDate);
    });
</script>

<% if(typeof annotation != 'undefined') { %>
    <script>
        var annotation = <%- JSON.stringify(annotation) %>;
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 550,
                eventContent: function(arg) {
                    let arrayOfDomNodes = [];

                    let titleEvent = document.createElement('div');
                    if(arg.event._def.title) {
                        titleEvent.innerHTML = arg.event._def.title;
                        titleEvent.classList = "fc-event-title fc-sticky";
                    }
        
                    arrayOfDomNodes = [ titleEvent ];
        
                    return { domNodes: arrayOfDomNodes }
                },
                events: annotation,
                dateClick: function(info) {
                    $("#eventModal").appendTo("body").modal('show');
                    $('#eventModal').on('shown.bs.modal', function (event) {
                        var annotationDate = info.dateStr;

                        var modal = $(this);
                        modal.find('.modal-body #fecha_anotacion').val(annotationDate);
                    });
                },
                eventClick: function(info) {
                    $("#modalModifyEvent").appendTo("body").modal('show');
                    $('#modalModifyEvent').on('shown.bs.modal', function (event) {
                        var annotationDescription = info.event._def.extendedProps.description;
                        var annotationEndPeriod = info.event._def.extendedProps.endPeriod;
                        var annotationSexualAct = info.event._def.extendedProps.sexualAct;
                        var annotationActualWeight = info.event._def.extendedProps.actualWeight;
                        var annotationMood = info.event._def.extendedProps.mood;
                        var annotationId = info.event._def.publicId;

                        var modal = $(this);
                        modal.find('.modal-body #descripcion_anotacion').val(annotationDescription);
                        modal.find('.modal-body #fin_periodo_anotacion').val(annotationEndPeriod);
                        modal.find('.modal-body #fecha_acto_sexual_anotacion').val(annotationSexualAct);
                        modal.find('.modal-body #peso_actual_anotacion').val(annotationActualWeight);
                        if (annotationMood === 'sad') {
                            modal.find('.modal-body #sad-two').prop('checked', true);
                        } else if (annotationMood === 'regular') {
                            modal.find('.modal-body #regular-two').prop('checked', true);
                        } else if (annotationMood === 'happy') {
                            modal.find('.modal-body #happy-two').prop('checked', true);
                        }
                        modal.find('.modal-body #id_anotacion').val(annotationId);
                    });
                },
            });
            calendar.render();
        });
    </script>
<% } else { %>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 550,
                dateClick: function(info) {
                    $("#eventModal").appendTo("body").modal('show');
                    $('#eventModal').on('shown.bs.modal', function (event) {
                        var annotationDate = info.dateStr;

                        var modal = $(this);
                        modal.find('.modal-body #fecha_anotacion').val(annotationDate);
                    });
                },
            });
            calendar.render();
        });
    </script>
<% } %>

</html>
